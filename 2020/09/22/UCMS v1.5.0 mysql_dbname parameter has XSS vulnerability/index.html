<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>&#39;UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability&#39; | LS-Loophole</title>
  <meta name="keywords" content="">
  <meta name="description" content="&#39;UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability&#39; | LS-Loophole">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Zip uses win feature to decompress, bypass blacklist and uploadVulnerability Type :File upload Vulnerability Version :YouDianCMS V9.1 Recurring environment: Windows 10 PHP 5.4.5 Apache 2.4.23  Vulnera">
<meta property="og:type" content="article">
<meta property="og:title" content="&#39;Zip uses win feature to decompress, bypass blacklist and upload&#39;">
<meta property="og:url" content="https://ls-loophole.github.io/2021/01/10/YouDianCMS%C2%A0V9.1%20Zip%20uses%20win%20feature%20to%20decompress,%20bypass%20blacklist%20and%20upload/index.html">
<meta property="og:site_name" content="LS-Loophole">
<meta property="og:description" content="Zip uses win feature to decompress, bypass blacklist and uploadVulnerability Type :File upload Vulnerability Version :YouDianCMS V9.1 Recurring environment: Windows 10 PHP 5.4.5 Apache 2.4.23  Vulnera">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/99.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/100.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i1.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i2.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i3.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i4.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i5.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i6.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i7.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i8.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i9.png">
<meta property="og:image" content="https://ls-loophole.github.io/imgss/i10.png">
<meta property="article:published_time" content="2021-01-09T16:54:55.534Z">
<meta property="article:modified_time" content="2021-01-09T17:02:58.888Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ls-loophole.github.io/imgss/99.png">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 5.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span></span>
</div>

<div class="icon">
    
</div>




<ul>
    <li><div class="all active" data-rel="全部文章">全部文章<small>(14)</small></div></li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="14">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="全部文章 "
           href="/2021/01/10/YouDianCMS%C2%A0V9.1%20Zip%20uses%20win%20feature%20to%20decompress,%20bypass%20blacklist%20and%20upload/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;Zip uses win feature to decompress, bypass blacklist and upload&#39;">&#39;Zip uses win feature to decompress, bypass blacklist and upload&#39;</span>
            <span class="post-date" title="2021-01-10 00:54:55">2021/01/10</span>
        </a>
        
        <a  class="全部文章 "
           href="/2021/01/10/YouDianCMS%20V9.1%20%20Bypass%20suffix%20filtering,%20image%20content%20detection%20and%20upload/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;YouDianCMS V9.1  Bypass suffix filtering, image content detection and upload&#39;">&#39;YouDianCMS V9.1  Bypass suffix filtering, image content detection and upload&#39;</span>
            <span class="post-date" title="2021-01-10 00:44:01">2021/01/10</span>
        </a>
        
        <a  class="全部文章 "
           href="/2021/01/10/OTCMS%20%20V5.66%20%20Database%20backup%20file%20download%20vulnerability/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;OTCMS  V5.66  Database backup file download vulnerability&#39;">&#39;OTCMS  V5.66  Database backup file download vulnerability&#39;</span>
            <span class="post-date" title="2021-01-10 00:27:47">2021/01/10</span>
        </a>
        
        <a  class="全部文章 "
           href="/2021/01/10/OTCMS%20%20V5.66%20%20%20Delete%20any%20file/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;OTCMS  V5.66   Delete any file&#39;">&#39;OTCMS  V5.66   Delete any file&#39;</span>
            <span class="post-date" title="2021-01-10 00:17:14">2021/01/10</span>
        </a>
        
        <a  class="全部文章 "
           href="/2021/01/10/Oklite%20V2.0.32%20arbitrary%20suffix%20modification%20vulnerability/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;Oklite V2.0.32 arbitrary suffix modification vulnerability&#39;">&#39;Oklite V2.0.32 arbitrary suffix modification vulnerability&#39;</span>
            <span class="post-date" title="2021-01-10 00:11:09">2021/01/10</span>
        </a>
        
        <a  class="全部文章 "
           href="/2021/01/10/Oklite%20V2.0.32%20%20arbitrary%20suffix%20creation%20vulnerability/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;Oklite V2.0.32  arbitrary suffix creation vulnerability&#39;">&#39;Oklite V2.0.32  arbitrary suffix creation vulnerability&#39;</span>
            <span class="post-date" title="2021-01-10 00:06:02">2021/01/10</span>
        </a>
        
        <a  class="全部文章 "
           href="/2021/01/09/LzCMS%20v1.1.5%20File%20upload/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;LzCMS v1.1.5 File upload&#39;">&#39;LzCMS v1.1.5 File upload&#39;</span>
            <span class="post-date" title="2021-01-09 23:55:52">2021/01/09</span>
        </a>
        
        <a  class="全部文章 "
           href="/2020/09/22/UCMS%20v1.4.0-8%20Arbitrary%20file%20upload%20vulnerability/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;UCMS v1.4.0-8 Arbitrary file upload vulnerability&#39;">&#39;UCMS v1.4.0-8 Arbitrary file upload vulnerability&#39;</span>
            <span class="post-date" title="2020-09-22 20:59:27">2020/09/22</span>
        </a>
        
        <a  class="全部文章 "
           href="/2020/09/22/UCMS%20v.1.4.0-7Command%20execution/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;UCMS v.1.4.0-7Command execution&#39;">&#39;UCMS v.1.4.0-7Command execution&#39;</span>
            <span class="post-date" title="2020-09-22 20:52:46">2020/09/22</span>
        </a>
        
        <a  class="全部文章 "
           href="/2020/09/22/UCMS%20v.1.5.0%20Command%20execution/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;UCMS v.1.5.0 Command execution&#39;">&#39;UCMS v.1.5.0 Command execution&#39;</span>
            <span class="post-date" title="2020-09-22 19:54:55">2020/09/22</span>
        </a>
        
        <a  class="全部文章 "
           href="/2020/09/22/Ready%20UCMS%20v1.5.0%20XSS%20dir%20parameter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;UCMS v1.5.0 XSS dir parameter&#39;">&#39;UCMS v1.5.0 XSS dir parameter&#39;</span>
            <span class="post-date" title="2020-09-22 19:48:41">2020/09/22</span>
        </a>
        
        <a  class="全部文章 "
           href="/2020/09/22/UCMS%20v1.5.0%20XSS%20cedit%20cname%20parameters/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;UCMS v1.5.0 XSS cedit cname parameters&#39;">&#39;UCMS v1.5.0 XSS cedit cname parameters&#39;</span>
            <span class="post-date" title="2020-09-22 19:34:59">2020/09/22</span>
        </a>
        
        <a  class="全部文章 "
           href="/2020/09/22/UCMS%20v1.5.0%20mysql_dbname%20parameter%20has%20XSS%20vulnerability/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability&#39;">&#39;UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability&#39;</span>
            <span class="post-date" title="2020-09-22 19:07:49">2020/09/22</span>
        </a>
        
        <a  class="全部文章 "
           href="/2020/09/22/UCMS%20v1.4.8%20SQL%20injection%20cvalue%20parameter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="&#39;UCMS v1.4.8 SQL injection cvalue parameter&#39;">&#39;UCMS v1.4.8 SQL injection cvalue parameter&#39;</span>
            <span class="post-date" title="2020-09-22 19:01:23">2020/09/22</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">&#39;UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability&#39;</h1>
    
    <div class="article-meta">
        
        
        
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2020-09-22 19:30:48'>2020-09-22 19:07</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#UCMS-v1-5-0-mysql-dbname-parameter-has-XSS-vulnerability"><span class="toc-text">UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Vulnerability-Type"><span class="toc-text">Vulnerability Type :</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vulnerability-Version"><span class="toc-text">Vulnerability Version :</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recurring-environment"><span class="toc-text">Recurring environment:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vulnerability-Description-AND-recurrence"><span class="toc-text">Vulnerability Description AND recurrence:</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="UCMS-v1-5-0-mysql-dbname-parameter-has-XSS-vulnerability"><a href="#UCMS-v1-5-0-mysql-dbname-parameter-has-XSS-vulnerability" class="headerlink" title="UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability"></a>UCMS v1.5.0 mysql_dbname parameter has XSS vulnerability</h1><h2 id="Vulnerability-Type"><a href="#Vulnerability-Type" class="headerlink" title="Vulnerability Type :"></a>Vulnerability Type :</h2><p>Cross Site Scripting(XSS)</p>
<h2 id="Vulnerability-Version"><a href="#Vulnerability-Version" class="headerlink" title="Vulnerability Version :"></a>Vulnerability Version :</h2><p>1.5.0</p>
<h2 id="Recurring-environment"><a href="#Recurring-environment" class="headerlink" title="Recurring environment:"></a>Recurring environment:</h2><ul>
<li>Windows 10</li>
<li>PHP 5.4.5</li>
<li>Apache 2.4.23</li>
</ul>
<h2 id="Vulnerability-Description-AND-recurrence"><a href="#Vulnerability-Description-AND-recurrence" class="headerlink" title="Vulnerability Description AND recurrence:"></a>Vulnerability Description AND recurrence:</h2><p>There is an XSS vulnerability in $_POST[‘mysql_dbname’] in /install/index.php of ucms1.5.0. The vulnerability is at line 226 of the current file</p>
<p><img src="/imgss/7.png"></p>
<p>There is a trigger condition where $ifin is equal to 0, continue to look online. Assign value to $ifin from line 210</p>
<p><img src="/imgss/8.png"></p>
<p>Assign a value of 0 to $ifin on line 217 for the first time, and then enter the loop judgment on line 218 to determine whether $val[‘Database’] is equal to the passed in’mysql_dbname’. If they are equal then $ifin is 1, so that our die() operation will not be executed. Find the logical condition that’mysql_dbname’ is not equal to $val[‘Database’] here.</p>
<p>$val is a key in the $alldb array. Here is how the $alldb array is generated. Go back to line 216, you can see that it is the data returned after $db-&gt;all(‘SHOW DATABASES’). Here you can look at the all() method of the $db class.</p>
<p>It will pass in $sql to the function such as $this-&gt;query()</p>
<p><img src="/imgss/9.png"></p>
<p>In $this-&gt;query(), the native query function mysql_query() is used to query the incoming $sql</p>
<p><img src="/imgss/10.png"></p>
<p>Returning to line 216 here, it is clear that the function here is to transfer the following code to the database for execution. The meaning of the SQL statement is to view all the databases, then the content after line 219 means that when the database name of $_POST[‘mysql_dbname’] does not exist in the database, $ifin=0.</p>
<p><img src="/imgss/11.png"><br><img src="/imgss/12.png"></p>
<p>But there is another point in line 215, where the value passed in $_POST[‘mysql_dbname’] will be written to the database. Show databases after writing to the database, then the normal logic will not cause $ifin=0.</p>
<p><img src="/imgss/13.png"></p>
<p>Write the incoming characters into the database and compare them with the incoming characters. If they are not equal, XSS will be triggered. There is a problem here, how can we make them not equal? The truth is the closed comment injected by sql!</p>
<p>But there is a problem here, that is, the closing symbol is not a single quotation mark&apos;, but a `. Here we can pass in ucms1.5.0` – |&lt;script&gt;alert(&quot;CNVD&quot;)&lt;/script&gt;. In this way, what is written in the database is the name of the ucms1.5.0 database, which will be different when compared with the incoming ucms1.5.0` – |&lt;script&gt;alert(&quot;CNVD&quot;)&lt;/script&gt; when queried by show databases again. Thereby triggering XSS!</p>
<p><img src="/imgss/14.png"></p>
<p>After clicking install, step=2 will be triggered and XSS will be triggered</p>
<p><img src="/imgss/15.png"></p>
<p>Payload</p>
<pre><code>POST /install/index.php?step=2 HTTP/1.1
Host: www.ucm1.5.0.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: http://www.ucm1.5.0.com/install/index.php?step=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 300
Connection: close
Upgrade-Insecure-Requests: 1


database=mysqlpdo&amp;mysql_host=127.0.0.1&amp;mysql_dbname=ucms1.5.0%60+--+%7C%3Cscript%3Ealert%28%22CNVD%22%29%3C%2Fscript%3E&amp;mysql_user=root&amp;mysql_password=roottoor&amp;sqlite_dbfile=c40c344d8021d096.db&amp;tableex=ucms_&amp;systemdomain=&amp;urlrewrite=1&amp;uuuadminname=admin&amp;uuuadminpassword=admin&amp;uuuadminpassword2=admin
</code></pre>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至lingyu195@gmail.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2020 LS-Loophole
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
